# Copy

## Database copy

때로는 테스트 목적으로 데이터베이스를 복사하는 경우가 있다.

### copy database

```sql
CREATE DATABASE book_db_test with TEMPLATE book_db;
```

복사하려는 데이터베이스에 활성 연결이 있는 경우 다음 오류가 발생한다.

```sql
ERROR:  source database "dvdrental" is being accessed by other users
DETAIL:  There is 1 other session using the database.
```

PID 확인 및 중지

```sql
SELECT pid, usename, client_addr FROM pg_stat_activity
WHERE datname = 'book_db';

SELECT pid, usename, client_addr FROM pg_stat_activity;

SELECT pg_terminate_backend (pid) FROM pg_stat_activity
WHERE datname = 'dvdrental';

SELECT pg_terminate_backend (pid) FROM pg_stat_activity;
```

### copy using dump

```sql
pg_dump -U postgres -d sourcedb -f sourcedb.sql
psql -U postgres -d targetdb -f sourcedb.sql
```
